# Docker Log Parser

Real-time Docker container log viewer with SQL query analysis and GraphQL request management.

## Quick Start

```bash
# Build frontend (TypeScript + Vue)
cd web
npm install
npm run build
cd ..

# Build backend (Go)
./build.sh

# Or build individually
go build -o docker-log-viewer cmd/viewer/main.go

# Run viewer
./docker-log-viewer
```

Open [http://localhost:9000](http://localhost:9000)

## Development

### Frontend Development

```bash
cd web

# Install dependencies
npm install

# Start Vite dev server with hot reload
npm run dev

# Build for production
npm run build

# Type checking
npm run type-check

# Linting
npm run lint
npm run lint:fix

# Formatting
npm run format
npm run format:check
```

The frontend is built with:
- **Vue 3** - Progressive JavaScript framework
- **TypeScript** - Type-safe JavaScript
- **Vite** - Fast build tool and dev server
- **Vue Router** - Client-side routing
- Single File Components (.vue files)

### Backend Development

```bash
# Build Go backend
go build -o docker-log-viewer cmd/viewer/main.go

# Run with PostgreSQL for EXPLAIN feature
export DATABASE_URL="postgresql://user:pass@localhost:5432/db"
./docker-log-viewer
```

## Features

- **Real-time streaming** - Monitor all Docker containers simultaneously
- **Smart parsing** - Structured logs (key=value), JSON, timestamps, log levels
- **Interactive filtering** - Container selection, log level, live search, trace filtering
- **SQL analysis** - Query statistics, N+1 detection, slowest queries
- **EXPLAIN plans** - PostgreSQL execution plan visualization with PEV2 (requires DB connection)
- **Request Management** - Save, execute, and analyze GraphQL/API requests
- **Before/After Analysis** - Track request performance over time
- **TypeScript + Vue 3** - Modern, type-safe frontend with reactive UI

## Architecture

### Frontend (web/)
- `src/` - TypeScript + Vue source code
  - `views/` - Page components (LogsView, RequestsView, etc.)
  - `components/` - Reusable components (AppHeader, AppNav)
  - `router/` - Vue Router configuration
  - `utils/` - Utility functions (API client)
  - `types/` - TypeScript type definitions
- `static/` - Static assets (CSS, libraries)
- `dist/` - Built output (generated by Vite)

### Backend (cmd/, pkg/)
- `cmd/viewer/` - Main web server
- `pkg/logs/` - Docker log parsing
- `pkg/sqlexplain/` - SQL EXPLAIN functionality
- `pkg/store/` - Request/execution storage

Save and execute GraphQL/API requests with full log capture and SQL analysis.

**Web UI**: [http://localhost:9000/requests.html](http://localhost:9000/requests.html)

**CLI**:
```bash
# Save a request
./graphql-tester -url "https://api.example.com/graphql" \
                 -data graphql-operations-unique/AuthConfig.json

# Execute immediately
./graphql-tester -url "https://api.example.com/graphql" \
                 -data operations/query.json \
                 -execute

# List saved requests
./graphql-tester -list
```



### Comparison Tool

Compare API endpoints by analyzing logs and SQL performance.

```bash
go build -o compare cmd/compare/main.go
./compare -url1 <url1> -url2 <url2> -data request.json
```

Generates HTML report with SQL statistics and performance comparison.

### Query Analysis Tool

Compare SQL queries from two saved execution IDs.

```bash
go build -o analyze cmd/analyze/main.go
./analyze -exec1 1 -exec2 2

# Save to file
./analyze -exec1 1 -exec2 2 -output report.txt

# Verbose mode with all queries
./analyze -exec1 1 -exec2 2 -verbose
```

Analyzes query performance, identifies regressions, and provides index recommendations.
See [cmd/analyze/README.md](cmd/analyze/README.md) for full documentation.

## Requirements

- Go 1.21+
- Docker daemon running
- PostgreSQL (optional, for EXPLAIN feature)

## Development

### Code Formatting and Linting

This project uses `gofmt` for Go code, and `prettier` and `eslint` for JavaScript/HTML/CSS.

```bash
# Format all code (Go, JS, HTML, CSS, JSON)
make format

# Check formatting without modifying files
make format-check

# Lint JavaScript code
make lint

# Lint and auto-fix JavaScript code
make lint-fix

# Build the project
make build

# Run tests
make test
```

**Manual commands:**

```bash
# Go formatting
gofmt -w .
gofmt -l .  # check only

# JavaScript/HTML/CSS formatting (in web directory)
cd web
npm run format       # format all files
npm run format:check # check only
npm run lint         # lint JavaScript
npm run lint:fix     # lint and auto-fix
```

## Documentation

- [AGENTS.md](AGENTS.md) - Developer guide
- [cmd/analyze/README.md](cmd/analyze/README.md) - Query analysis tool documentation
- [pkg/sqlexplain/README.md](pkg/sqlexplain/README.md) - SQL explain plan analyzers

## Architecture

```
docker-log-parser/
├── cmd/
│   ├── viewer/         # Web-based log viewer
│   └── compare/        # URL comparison tool
├── pkg/
│   ├── logs/           # Docker & log parsing
│   └── sqlexplain/     # PostgreSQL EXPLAIN
└── web/                # Frontend assets
```

## License

MIT
