<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GraphQL Schema Tree View - Demo</title>
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      .demo-wrapper {
        display: flex;
        height: 100vh;
        background: #0d1117;
      }
      .sidebar-demo {
        width: 400px;
        background: #161b22;
        border-right: 1px solid #30363d;
        padding: 1rem;
        overflow-y: auto;
      }
      .content-demo {
        flex: 1;
        padding: 2rem;
        color: #c9d1d9;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script src="lib/vue.global.prod.js"></script>
    <script>
      const { createApp } = Vue;

      const app = createApp({
        data() {
          return {
            schema: {
              queryType: { name: "Query" },
              mutationType: { name: "Mutation" },
              types: [
                {
                  kind: "OBJECT",
                  name: "Query",
                  description: "The root query type",
                  fields: [
                    {
                      name: "user",
                      description: "Get a user by ID",
                      args: [
                        {
                          name: "id",
                          description: "The user ID",
                          type: {
                            kind: "NON_NULL",
                            ofType: { kind: "SCALAR", name: "ID" },
                          },
                        },
                      ],
                      type: { kind: "OBJECT", name: "User" },
                    },
                    {
                      name: "users",
                      description: "Get all users",
                      args: [
                        {
                          name: "limit",
                          description: "Maximum number of users to return",
                          type: { kind: "SCALAR", name: "Int" },
                        },
                      ],
                      type: {
                        kind: "LIST",
                        ofType: { kind: "OBJECT", name: "User" },
                      },
                    },
                    {
                      name: "posts",
                      description: "Get all posts",
                      args: [],
                      type: {
                        kind: "LIST",
                        ofType: { kind: "OBJECT", name: "Post" },
                      },
                    },
                  ],
                },
                {
                  kind: "OBJECT",
                  name: "Mutation",
                  description: "The root mutation type",
                  fields: [
                    {
                      name: "createUser",
                      description: "Create a new user",
                      args: [
                        {
                          name: "input",
                          description: "User input data",
                          type: {
                            kind: "NON_NULL",
                            ofType: {
                              kind: "INPUT_OBJECT",
                              name: "CreateUserInput",
                            },
                          },
                        },
                      ],
                      type: { kind: "OBJECT", name: "User" },
                    },
                    {
                      name: "updateUser",
                      description: "Update an existing user",
                      args: [
                        {
                          name: "id",
                          description: "User ID",
                          type: {
                            kind: "NON_NULL",
                            ofType: { kind: "SCALAR", name: "ID" },
                          },
                        },
                        {
                          name: "input",
                          description: "User update data",
                          type: {
                            kind: "NON_NULL",
                            ofType: {
                              kind: "INPUT_OBJECT",
                              name: "UpdateUserInput",
                            },
                          },
                        },
                      ],
                      type: { kind: "OBJECT", name: "User" },
                    },
                    {
                      name: "deleteUser",
                      description: "Delete a user",
                      args: [
                        {
                          name: "id",
                          description: "User ID to delete",
                          type: {
                            kind: "NON_NULL",
                            ofType: { kind: "SCALAR", name: "ID" },
                          },
                        },
                      ],
                      type: { kind: "SCALAR", name: "Boolean" },
                    },
                  ],
                },
                {
                  kind: "OBJECT",
                  name: "User",
                  description: "A user in the system",
                  fields: [
                    {
                      name: "id",
                      description: "User ID",
                      args: [],
                      type: {
                        kind: "NON_NULL",
                        ofType: { kind: "SCALAR", name: "ID" },
                      },
                    },
                    {
                      name: "name",
                      description: "User's full name",
                      args: [],
                      type: { kind: "SCALAR", name: "String" },
                    },
                    {
                      name: "email",
                      description: "User's email address",
                      args: [],
                      type: { kind: "SCALAR", name: "String" },
                    },
                    {
                      name: "posts",
                      description: "Posts created by this user",
                      args: [],
                      type: {
                        kind: "LIST",
                        ofType: { kind: "OBJECT", name: "Post" },
                      },
                    },
                  ],
                },
                {
                  kind: "OBJECT",
                  name: "Post",
                  description: "A blog post",
                  fields: [
                    {
                      name: "id",
                      description: "Post ID",
                      args: [],
                      type: {
                        kind: "NON_NULL",
                        ofType: { kind: "SCALAR", name: "ID" },
                      },
                    },
                    {
                      name: "title",
                      description: "Post title",
                      args: [],
                      type: { kind: "SCALAR", name: "String" },
                    },
                    {
                      name: "content",
                      description: "Post content",
                      args: [],
                      type: { kind: "SCALAR", name: "String" },
                    },
                    {
                      name: "author",
                      description: "Post author",
                      args: [],
                      type: { kind: "OBJECT", name: "User" },
                    },
                  ],
                },
              ],
            },
            expandedSections: {
              queries: true,
              mutations: true,
              types: false,
            },
            expandedFields: {},
            expandedTypes: {},
          };
        },
        computed: {
          schemaTypes() {
            return this.schema?.types || [];
          },
          queryType() {
            return this.schema?.queryType;
          },
          mutationType() {
            return this.schema?.mutationType;
          },
        },
        methods: {
          toggleSection(section) {
            this.expandedSections[section] = !this.expandedSections[section];
          },
          toggleField(key) {
            if (this.expandedFields[key]) {
              delete this.expandedFields[key];
            } else {
              this.expandedFields[key] = true;
            }
          },
          toggleType(typeName) {
            if (this.expandedTypes[typeName]) {
              delete this.expandedTypes[typeName];
            } else {
              this.expandedTypes[typeName] = true;
            }
          },
          isFieldExpanded(key) {
            return !!this.expandedFields[key];
          },
          isTypeExpanded(typeName) {
            return !!this.expandedTypes[typeName];
          },
          getTypeString(type) {
            if (!type) return "Unknown";

            let typeStr = "";
            let currentType = type;
            let nonNull = false;
            let isList = false;

            while (currentType) {
              if (currentType.kind === "NON_NULL") {
                nonNull = true;
                currentType = currentType.ofType;
              } else if (currentType.kind === "LIST") {
                isList = true;
                currentType = currentType.ofType;
              } else {
                typeStr = currentType.name || "Unknown";
                break;
              }
            }

            if (isList) {
              typeStr = "[" + typeStr + "]";
            }
            if (nonNull) {
              typeStr += "!";
            }

            return typeStr;
          },
          getObjectTypes() {
            return this.schemaTypes.filter(
              (t) =>
                !t.name.startsWith("__") &&
                t.kind === "OBJECT" &&
                t.name !== this.queryType?.name &&
                t.name !== this.mutationType?.name
            );
          },
        },
        template: `
                <div class="demo-wrapper">
                    <aside class="sidebar-demo">
                        <h3 style="margin: 0 0 1rem 0; color: #58a6ff;">GraphQL Schema</h3>
                        
                        <!-- Queries Section -->
                        <div v-if="queryType" style="margin-bottom: 1rem;">
                            <div 
                                @click="toggleSection('queries')" 
                                style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; background: #161b22; border-radius: 4px; margin-bottom: 0.5rem; border: 1px solid #30363d;"
                                @mouseover="$event.currentTarget.style.background = '#21262d'"
                                @mouseout="$event.currentTarget.style.background = '#161b22'">
                                <span :style="{ transform: expandedSections.queries ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }">â–¶</span>
                                <h4 style="color: #58a6ff; font-size: 0.875rem; margin: 0; text-transform: uppercase; flex: 1;">Queries</h4>
                                <span style="color: #8b949e; font-size: 0.75rem;">{{ schemaTypes.filter(t => t.name === queryType.name)[0]?.fields?.length || 0 }}</span>
                            </div>
                            <div v-if="expandedSections.queries" v-for="type in schemaTypes.filter(t => t.name === queryType.name)" :key="type.name">
                                <div v-if="type.fields" style="font-size: 0.8rem; margin-left: 0.5rem;">
                                    <div v-for="field in type.fields" :key="field.name" style="margin-bottom: 0.5rem;">
                                        <div 
                                            @click="toggleField('query-' + field.name)" 
                                            style="padding: 0.5rem; background: #0d1117; border-radius: 4px; border: 1px solid #30363d; cursor: pointer;"
                                            @mouseover="$event.currentTarget.style.borderColor = '#58a6ff'"
                                            @mouseout="$event.currentTarget.style.borderColor = '#30363d'">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span :style="{ transform: isFieldExpanded('query-' + field.name) ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block', fontSize: '0.7rem' }">â–¶</span>
                                                <div style="flex: 1;">
                                                    <span style="font-weight: 500; color: #79c0ff;">{{ field.name }}</span>
                                                    <span style="color: #8b949e; font-size: 0.7rem; margin-left: 0.5rem;">: {{ getTypeString(field.type) }}</span>
                                                </div>
                                                <button 
                                                    @click.stop
                                                    style="background: #238636; color: white; border: none; padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.65rem; cursor: pointer;"
                                                    title="Insert into query">+</button>
                                            </div>
                                            <div v-if="isFieldExpanded('query-' + field.name)" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #30363d;">
                                                <div v-if="field.description" style="color: #8b949e; font-size: 0.7rem; margin-bottom: 0.5rem; font-style: italic;">{{ field.description }}</div>
                                                <div v-if="field.args && field.args.length > 0" style="font-size: 0.7rem;">
                                                    <div style="color: #8b949e; margin-bottom: 0.25rem; font-weight: 500;">Arguments:</div>
                                                    <div v-for="arg in field.args" :key="arg.name" style="margin-left: 0.5rem; margin-bottom: 0.25rem;">
                                                        <span style="color: #a5d6ff;">{{ arg.name }}</span>
                                                        <span style="color: #8b949e;">: {{ getTypeString(arg.type) }}</span>
                                                        <div v-if="arg.description" style="color: #6e7681; font-size: 0.65rem; margin-left: 0.5rem;">{{ arg.description }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mutations Section -->
                        <div v-if="mutationType" style="margin-bottom: 1rem;">
                            <div 
                                @click="toggleSection('mutations')" 
                                style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; background: #161b22; border-radius: 4px; margin-bottom: 0.5rem; border: 1px solid #30363d;"
                                @mouseover="$event.currentTarget.style.background = '#21262d'"
                                @mouseout="$event.currentTarget.style.background = '#161b22'">
                                <span :style="{ transform: expandedSections.mutations ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }">â–¶</span>
                                <h4 style="color: #f0883e; font-size: 0.875rem; margin: 0; text-transform: uppercase; flex: 1;">Mutations</h4>
                                <span style="color: #8b949e; font-size: 0.75rem;">{{ schemaTypes.filter(t => t.name === mutationType.name)[0]?.fields?.length || 0 }}</span>
                            </div>
                            <div v-if="expandedSections.mutations" v-for="type in schemaTypes.filter(t => t.name === mutationType.name)" :key="type.name">
                                <div v-if="type.fields" style="font-size: 0.8rem; margin-left: 0.5rem;">
                                    <div v-for="field in type.fields" :key="field.name" style="margin-bottom: 0.5rem;">
                                        <div 
                                            @click="toggleField('mutation-' + field.name)" 
                                            style="padding: 0.5rem; background: #0d1117; border-radius: 4px; border: 1px solid #30363d; cursor: pointer;"
                                            @mouseover="$event.currentTarget.style.borderColor = '#f0883e'"
                                            @mouseout="$event.currentTarget.style.borderColor = '#30363d'">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span :style="{ transform: isFieldExpanded('mutation-' + field.name) ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block', fontSize: '0.7rem' }">â–¶</span>
                                                <div style="flex: 1;">
                                                    <span style="font-weight: 500; color: #f0883e;">{{ field.name }}</span>
                                                    <span style="color: #8b949e; font-size: 0.7rem; margin-left: 0.5rem;">: {{ getTypeString(field.type) }}</span>
                                                </div>
                                                <button 
                                                    @click.stop
                                                    style="background: #da3633; color: white; border: none; padding: 0.15rem 0.4rem; border-radius: 3px; font-size: 0.65rem; cursor: pointer;"
                                                    title="Insert into query">+</button>
                                            </div>
                                            <div v-if="isFieldExpanded('mutation-' + field.name)" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #30363d;">
                                                <div v-if="field.description" style="color: #8b949e; font-size: 0.7rem; margin-bottom: 0.5rem; font-style: italic;">{{ field.description }}</div>
                                                <div v-if="field.args && field.args.length > 0" style="font-size: 0.7rem;">
                                                    <div style="color: #8b949e; margin-bottom: 0.25rem; font-weight: 500;">Arguments:</div>
                                                    <div v-for="arg in field.args" :key="arg.name" style="margin-left: 0.5rem; margin-bottom: 0.25rem;">
                                                        <span style="color: #a5d6ff;">{{ arg.name }}</span>
                                                        <span style="color: #8b949e;">: {{ getTypeString(arg.type) }}</span>
                                                        <div v-if="arg.description" style="color: #6e7681; font-size: 0.65rem; margin-left: 0.5rem;">{{ arg.description }}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Types Section -->
                        <div>
                            <div 
                                @click="toggleSection('types')" 
                                style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.5rem; background: #161b22; border-radius: 4px; margin-bottom: 0.5rem; border: 1px solid #30363d;"
                                @mouseover="$event.currentTarget.style.background = '#21262d'"
                                @mouseout="$event.currentTarget.style.background = '#161b22'">
                                <span :style="{ transform: expandedSections.types ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block' }">â–¶</span>
                                <h4 style="color: #8b949e; font-size: 0.875rem; margin: 0; text-transform: uppercase; flex: 1;">Types</h4>
                                <span style="color: #8b949e; font-size: 0.75rem;">{{ getObjectTypes().length }}</span>
                            </div>
                            <div v-if="expandedSections.types" style="margin-left: 0.5rem;">
                                <div v-for="type in getObjectTypes()" :key="type.name" style="margin-bottom: 0.5rem;">
                                    <div 
                                        @click="toggleType(type.name)" 
                                        style="padding: 0.5rem; background: #0d1117; border-radius: 4px; border: 1px solid #30363d; cursor: pointer;"
                                        @mouseover="$event.currentTarget.style.borderColor = '#8b949e'"
                                        @mouseout="$event.currentTarget.style.borderColor = '#30363d'">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span v-if="type.fields && type.fields.length > 0" :style="{ transform: isTypeExpanded(type.name) ? 'rotate(90deg)' : 'rotate(0deg)', transition: 'transform 0.2s', display: 'inline-block', fontSize: '0.7rem' }">â–¶</span>
                                            <span v-else style="width: 0.7rem; display: inline-block;"></span>
                                            <span style="font-weight: 500; color: #c9d1d9; flex: 1; font-size: 0.75rem;">{{ type.name }}</span>
                                            <span v-if="type.fields" style="color: #8b949e; font-size: 0.65rem;">{{ type.fields.length }} fields</span>
                                        </div>
                                        <div v-if="isTypeExpanded(type.name) && type.fields" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #30363d;">
                                            <div v-if="type.description" style="color: #8b949e; font-size: 0.7rem; margin-bottom: 0.5rem; font-style: italic;">{{ type.description }}</div>
                                            <div v-for="field in type.fields" :key="field.name" style="margin-bottom: 0.25rem; font-size: 0.7rem; margin-left: 0.5rem;">
                                                <span style="color: #a5d6ff;">{{ field.name }}</span>
                                                <span style="color: #8b949e;">: {{ getTypeString(field.type) }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <main class="content-demo">
                        <h1 style="color: #58a6ff; margin-top: 0;">GraphQL Schema Tree View</h1>
                        <p style="color: #8b949e; font-size: 1rem;">Interactive demonstration of the enhanced schema sidebar</p>
                        
                        <div style="margin-top: 2rem; background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1.5rem;">
                            <h2 style="color: #f0883e; margin-top: 0;">Features</h2>
                            <ul style="line-height: 2;">
                                <li>ðŸŒ³ <strong>Tree View Structure</strong> - Hierarchical organization of schema elements</li>
                                <li>ðŸ”½ <strong>Collapsible Sections</strong> - Expand/collapse Queries, Mutations, and Types</li>
                                <li>ðŸ“Š <strong>Field Details</strong> - View arguments, types, and descriptions</li>
                                <li>âž• <strong>Quick Insert</strong> - Add fields to your query with one click</li>
                                <li>ðŸŽ¨ <strong>Color Coding</strong> - Visual distinction between queries and mutations</li>
                                <li>ðŸ’¡ <strong>Type Explorer</strong> - Browse custom types and their fields</li>
                            </ul>
                        </div>

                        <div style="margin-top: 2rem; background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1.5rem;">
                            <h2 style="color: #7ee787; margin-top: 0;">Try It Out</h2>
                            <ol style="line-height: 2;">
                                <li>Click the section headers (Queries, Mutations, Types) to expand/collapse them</li>
                                <li>Click on individual fields to see their details</li>
                                <li>Hover over elements to see interactive highlights</li>
                                <li>Click the <code style="background: #0d1117; padding: 0.2rem 0.4rem; border-radius: 3px; color: #7ee787;">+</code> button to simulate inserting a field</li>
                            </ol>
                        </div>
                    </main>
                </div>
            `,
      });

      app.mount("#app");
    </script>
  </body>
</html>
